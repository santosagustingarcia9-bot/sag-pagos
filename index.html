<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAG & SK - Payment</title>

<script src="https://sdk.mercadopago.com/js/v2"></script>

<style>
body{
  font-family: Arial;
  background:#f5f5f5;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

.card{
  background:white;
  width:360px;
  padding:25px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
}

.resumen{
  background:#eee;
  padding:10px;
  border-radius:10px;
  display:flex;
  justify-content:space-between;
  margin-bottom:20px;
}

.method{
  border:2px solid #eee;
  padding:15px;
  border-radius:12px;
  text-align:center;
  margin-bottom:15px;
  cursor:pointer;
}

.method:hover{
  border-color:#7b5cff;
}

.method img{
  height:30px;
  margin:5px;
}

input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

.btn{
  background:linear-gradient(90deg,#7b5cff,#5f3bff);
  color:white;
  border:none;
  padding:12px;
  width:100%;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="card">

<h2>SAG & SK</h2>

<div class="resumen">
  <span>Combinada del día</span>
  <span>$ 5000 ARS</span>
</div>

<div class="method" onclick="pagarMP()">
  <img src="https://logodownload.org/wp-content/uploads/2014/07/mercado-pago-logo.png">
  <p>Pagar con MercadoPago</p>
</div>

<div class="method">
  <img src="https://img.icons8.com/color/48/visa.png"/>
  <img src="https://img.icons8.com/color/48/mastercard.png"/>
  <img src="https://img.icons8.com/color/48/amex.png"/>
  <p>Pagar con tarjeta débito o crédito</p>
</div>

<form id="card-form">

<input type="text" id="name" placeholder="Nombre completo" required>

<input type="text" id="cardNumber" placeholder="Número de tarjeta" maxlength="16" required>

<input type="text" id="expiry" placeholder="MM/AA" maxlength="5" required>

<input type="text" id="cvv" placeholder="CVV" maxlength="4" required>

<button type="submit" class="btn">Confirmar pago</button>

</form>

</div>

<script src="https://sdk.mercadopago.com/js/v2"></script>

<script>
const mp = new MercadoPago("TU_PUBLIC_KEY_AQUI");

// =======================
// MERCADOPAGO REDIRECT
// =======================
async function pagarMP(){
  const response = await fetch("/crear-preferencia",{ method:"POST" });
  const data = await response.json();

  mp.checkout({
    preference:{ id:data.id },
    autoOpen:true
  });
}

// =======================
// VALIDACIONES VISUALES
// =======================

// Solo números tarjeta
document.getElementById("cardNumber").addEventListener("input", function(){
  this.value = this.value.replace(/\D/g,'').slice(0,16);
});

// Fecha automática MM/AA
document.getElementById("expiry").addEventListener("input", function(){
  this.value = this.value.replace(/\D/g,'');
  if(this.value.length >= 3){
    this.value = this.value.slice(0,2) + "/" + this.value.slice(2,4);
  }
  this.value = this.value.slice(0,5);
});

// Solo números CVV
document.getElementById("cvv").addEventListener("input", function(){
  this.value = this.value.replace(/\D/g,'').slice(0,4);
});

// =======================
// ENVIAR TARJETA REAL
// =======================
document.getElementById("card-form").addEventListener("submit", async function(e){
  e.preventDefault();

  const response = await fetch("/procesar-pago", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      amount: 5000,
      token: "TEST-TOKEN", // ⚠ aquí luego se conecta con cardForm oficial
      installments: 1,
      paymentMethodId: "visa",
      issuerId: null,
      identificationType: "DNI",
      identificationNumber: "12345678"
    })
  });

  const data = await response.json();
  alert("Estado del pago: " + data.status);
});
</script>

</body>
</html>

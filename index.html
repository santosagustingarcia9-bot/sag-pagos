<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAG & SK - Payment</title>

<script src="https://sdk.mercadopago.com/js/v2"></script>

<style>
body{
  background:#f3f4f6;
  font-family:Arial;
  display:flex;
  justify-content:center;
  padding:20px;
}
.card{
  background:white;
  max-width:420px;
  width:100%;
  border-radius:20px;
  padding:30px;
  text-align:center;
}
.logo{
  width:120px;
  border-radius:50%;
}
.method{
  border:1px solid #ddd;
  border-radius:12px;
  padding:15px;
  margin-top:15px;
  cursor:pointer;
}
button{
  margin-top:20px;
  width:100%;
  padding:15px;
  border:none;
  border-radius:12px;
  background:linear-gradient(90deg,#5f6cff,#8a63ff);
  color:white;
  font-size:16px;
}
</style>
</head>

<body>

<div class="card">

<img src="https://i.ibb.co/20wwmg12/tu-logo.png" class="logo">

<h2>SAG & SK</h2>
<p style="color:green;">✔ Pronosticador verificado</p>

<h3>Resumen de compra</h3>
<p><b>Combinada del día</b></p>
<p><b>$ 5000 ARS</b></p>

<div class="method" onclick="mercado()">
<img src="https://logodownload.org/wp-content/uploads/2019/06/mercado-pago-logo-6.png" width="120">
</div>

<div class="method" onclick="mostrarTarjeta()">
<img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg" width="70">
<img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" width="70">
</div>

<div id="cardForm" style="display:none; margin-top:20px;">
<form id="form-checkout">
<div id="form-checkout__cardNumber"></div>
<div id="form-checkout__expirationDate"></div>
<div id="form-checkout__securityCode"></div>
<input type="email" id="form-checkout__cardholderEmail" placeholder="Email" />
<select id="form-checkout__installments"></select>
<button type="submit">Confirmar Pago</button>
</form>
</div>

</div>

<script>
const mp = new MercadoPago("APP_USR-afc13ecc-e106-4c83-9b96-6df76a8e2c8e", { locale: "es-AR" });

function mercado(){
fetch("/create_preference", { method:"POST" })
.then(res => res.json())
.then(data => {
mp.checkout({
preference: { id: data.id },
autoOpen: true
});
});
}

function mostrarTarjeta(){
document.getElementById("cardForm").style.display="block";
}

const cardForm = mp.cardForm({
amount: "5000",
autoMount: true,
form: {
id: "form-checkout",
cardNumber: { id: "form-checkout__cardNumber" },
expirationDate: { id: "form-checkout__expirationDate" },
securityCode: { id: "form-checkout__securityCode" },
cardholderEmail: { id: "form-checkout__cardholderEmail" },
installments: { id: "form-checkout__installments" }
},
callbacks: {
onSubmit: event => {
event.preventDefault();

const data = cardForm.getCardFormData();

fetch("/process_payment", {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({
token: data.token,
installments: data.installments,
payment_method_id: data.paymentMethodId,
transaction_amount: Number(data.amount),
payer: { email: data.cardholderEmail }
})
})
.then(res => res.json())
.then(response => {
if(response.status === "approved"){
alert("Pago aprobado");
}else{
alert("Pago rechazado");
}
});
}
}
});
</script>

</body>
</html>
